head(nearctic_parasite_phyla_data)
## Phylogenetic comparative analysis analysis
## Get regimes for internal nodes
regimes <- corHMM(nearctic_parasite_tree, nearctic_parasite_phyla_data[,c(1,4)], model="ER", rate.cat=1, node.states = "marginal")
regimes$phy$node.label
?switch
switch(as.character(regimes$phy$node.label), "1"="Acanthocephala", "2"="Nematoda", "3"="Platyhelminthes")
sapply(as.character(regimes$phy$node.label), function(n) switch(n, "1"="Acanthocephala", "2"="Nematoda", "3"="Platyhelminthes"))
unname(sapply(as.character(regimes$phy$node.label), function(n) switch(n, "1"="Acanthocephala", "2"="Nematoda", "3"="Platyhelminthes")))
nearctic_parasite_phyla_data$regAsNum <- as.numeric(as.factor(nearctic_parasite_phyla_data$regime))
## Get regimes for internal nodes using corHMM
regimes <- corHMM(nearctic_parasite_tree, nearctic_parasite_phyla_data[,c(1,4)], model="ER", rate.cat=1, node.states = "marginal")
## Convert internal node regimes back to phylum names and assign to the tree
nearctic_parasite_tree$node.label <- unname(sapply(as.character(regimes$phy$node.label), function(n) switch(n, "1"="Acanthocephala", "2"="Nematoda", "3"="Platyhelminthes")))
nearctic_mpd_BM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data, model="BM", root.station=FALSE, scale=TRUE, quiet=TRUE)
unname(sapply(as.character(regimes$phy$node.label), function(n) switch(n, "1"="Acanthocephala", "2"="Nematoda", "3"="Platyhelminthes")))
nearctic_parasite_tree
nearctic_parasite_phyla_data
nearctic_mpd_BM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BM", root.station=FALSE, scale=TRUE, quiet=TRUE)
nearctic_parasite_tree$node.label
nearctic_parasite_phyla_data$regime
nearctic_parasite_phyla_data$regime%in%nearctic_parasite_tree$nodel.label
nearctic_parasite_phyla_data$regime%in%nearctic_parasite_tree$node.label
?OUwie
nearctic_mpd_BMS_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BMS", root.station=FALSE, scale=TRUE, quiet=TRUE)
nearctic_mpd_OUM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data, model="OUM", root.station=FALSE, scale=TRUE, quiet=TRUE)
nearctic_mpd_BMS_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BMS", root.station=FALSE, scale=TRUE, quiet=TRUE, ub=Inf)
nearctic_mpd_BMS_fit
nearctic_mpd_OUM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data, model="OUM", root.station=FALSE, scale=TRUE, quiet=TRUE, ub=Inf)
nearctic_mpd_OUM_fit
nearctic_parasite_ouchtree <- ape2ouch(nearctic_parasite_tree) ## convert to ouchtree object
## get the mpd data organized properly for ouch
nearctic_parasite_ouchdata <- rep(NA, length=nearctic_parasite_ouchtree@nnodes)
for (i in 1:length(nearctic_parasite_phyla_data$nearctic_parasite_tree.tip.label))
nearctic_parasite_ouchdata[which(nearctic_parasite_ouchtree@nodelabels==nearctic_parasite_phyla_data$nearctic_parasite_tree.tip.label[i])] <- nearctic_parasite_phyla_data$trait[i]
nearctic_parasite_ouchdata <- as.data.frame(nearctic_parasite_ouchdata)
nearctic_parasite_ouchtree@nodelabels%in%nearctic_parasite_phyla_data$nearctic_parasite_tree.tip.label[which(nearctic_parasite_phyla_data$regime=="Platyhelminthes")] %>% which -> platys
## get their lineages and find the nodes that are in common across all lineages
nearctic_parasite_ouchtree@lineages[platys] -> platy_lineages
platy_lineages[[1]][sapply(platy_lineages[[1]], function(n) lapply(platy_lineages, function(l) n%in%l) %>% unlist %>% all) %>% which %>% min] ## 1
nearctic_parasite_ouchtree@nodelabels%in%nearctic_parasite_phyla_data$nearctic_parasite_tree.tip.label[which(nearctic_parasite_phyla_data$regime=="Acanthocephala")] %>% which -> acanths
## get their lineages and find the nodes that are in common across all lineages
nearctic_parasite_ouchtree@lineages[acanths] -> acanth_lineages
acanth_lineages[[1]][sapply(acanth_lineages[[1]], function(n) lapply(acanth_lineages, function(l) n%in%l) %>% unlist %>% all) %>% which %>% min] ## 86
## Find the node that corresponds to the most recent common ancestor of all Nematodes
## which nodes in the ouchtree correspond to the Nematodes
nearctic_parasite_ouchtree@nodelabels%in%nearctic_parasite_phyla_data$nearctic_parasite_tree.tip.label[which(nearctic_parasite_phyla_data$regime=="Nematoda")] %>% which -> nematodes
## get their lineages and find the nodes that are in common across all lineages
nearctic_parasite_ouchtree@lineages[nematodes] -> nematode_lineages
nematode_lineages[[1]][sapply(nematode_lineages[[1]], function(n) lapply(nematode_lineages, function(l) n%in%l) %>% unlist %>% all) %>% which %>% min] #81
## paint the taxonomy-based regimes onto the tree
paint(nearctic_parasite_ouchtree, subtree=c("1"="Platys","86"="Acanths","81"="Nematodes"), branch=c("1"="Platys")) -> nearctic_oum_regimes
## paint a single global regime onto the tree
paint(nearctic_parasite_ouchtree, subtree=c("1"="global"), branch=c("1"="global")) -> nearctic_ou1_regimes
## Plot to make sure that you end up with a reasonable painting
plot(nearctic_parasite_ouchtree, regimes=nearctic_oum_regimes)
plot(nearctic_parasite_ouchtree, regimes=nearctic_oum_regimes)
plot(nearctic_parasite_ouchtree, regimes=nearctic_oum_regimes, cex=0.5)
?ouch::plot
plot(nearctic_parasite_ouchtree, regimes=nearctic_oum_regimes, text_opts=list(cex=0.5))
nearctic_oum_ouch <- hansen(data=nearctic_parasite_ouchdata, tree=nearctic_parasite_ouchtree, regimes=nearctic_oum_regimes, sqrt.alpha=100, sigma=100)
nearctic_oum_ouch
nearctic_mpd_OUM_fit
nearctic_mpd_BM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BM", root.station=FALSE, scale=TRUE, quiet=TRUE)
nearctic_mpd_BM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BM1", root.station=FALSE, scale=TRUE, quiet=TRUE)
nearctic_mpd_BM_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BM1", root.station=FALSE, scale=TRUE, quiet=TRUE, ub=Inf)
nearctic_mpd_BM_fit
nearctic_mpd_BM_fit$AICc
nearctic_mpd_BMS_fit$AICc
nearctic_mpd_OUM_fit$AICc
nearctic_mpd_BMS_fit
nearctic_mpd_OUM_fit
?OUwie
nearctic_mpd_BMS_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BMS", root.station=FALSE, scale=TRUE, quiet=TRUE, starting.vals=165000, ub=Inf)
nearctic_mpd_BMS_fit
nearctic_mpd_BMS_fit <- OUwie(nearctic_parasite_tree, nearctic_parasite_phyla_data[,1:3], model="BMS", root.station=FALSE, scale=TRUE, quiet=TRUE, starting.vals=16500, ub=Inf)
nearctic_mpd_BMS_fit
setwd("~/newGEM_SIR/Analysis Code/Covariation/Med_R0_simulations")
readRDS("population_dynamics_all_simulations_medvar.RDS")
data <- readRDS("population_dynamics_all_simulations_medvar.RDS")
data
var1=c('c','c','c','shed','shed','alpha')
var2=c('shed','alpha','gamma','alpha','gamma','gamma')
j = 3
paste(var1[j],var2[j],sep='-')
head(data)
?filter
covMatrix = "(0) Cov"
filter(data, traits==paste(var1[j],var2[j],sep='-'), cov==covMatrix)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix & Variance=="low")
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix & Variance=="low") %>% group_by(rep) %>% summarise(peak=max(I))
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=max(I))
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=max(I)) %>%
lm(peak~Variance-1)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=max(I)) %>%
as.data.frame() %>%
lm(peak~Variance-1)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=max(I)) %>%
as.data.frame()
as.data.frame()
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame()
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance-1))
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance-1)) %>% summary
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% summary
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% anova
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% summary
install.packages("emmeans")
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)
library(emmeans)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)
library(emmeans)
library(tidyverse)
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance) %>% print() ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
}
}
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)$contrasts %>% print() ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
}
}
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance) -> comparison
comparison$contrasts
comparison$contrasts %>% str
comparison
comparison$contrasts
comparison$contrasts
comparison$contrasts %>% as.data.frame
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix)
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-'))
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)$contrasts
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)[["contrasts"]]
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrasts[[i]]
i <- i + 1
}
}
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-'))contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrasts[[i]]
i <- i + 1
}
}
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-'))
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrats[[i]] <- contrast
i <- i + 1
}
}
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrast[[i]] <- contrast
i <- i + 1
}
}
contrasts
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts
contrasts %>% do.call("rbind.data.frame", .)
comparison$contrasts
comparison$contrasts %>% as.data.frame
comparison$contrasts %>% as.data.frame %>% signif(.,3)
contrasts %>% do.call("rbind.data.frame", .)
head(data)
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>% group_by(Covariance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Covariance)) %>% emmeans(pairwise~Covariance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .)
head(data)
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>% group_by(cov, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .)
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .)
saveRDS(contrasts, file="Var_effects_on_peak_stats.RDS")
write.csv(contrasts, file="Var_effects_on_peak_stats.csv")
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("(0) Cov", "(-) Cov", "(+) Cov")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
write.csv(contrasts2, file="Var_effects_on_peak_stats.csv")
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>% group_by(cov, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(peak~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
write.csv(contrasts2, file="Cov_effects_on_peak_stats.csv")
comparison
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>% group_by(cov, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() -> summ
summ
summ$cov
as.factor(summ$cov)
sapply(summ$cov, function(c) switch(c, "(-) Cov"=="neg", "(0) Cov"=="zero", "(+) Cov"=="pos"))
sapply(summ$cov, function(c) switch(c, "(-) Cov"="neg", "(0) Cov"="zero", "(+) Cov"="pos"))
sapply(summ$cov, function(c) switch(c, "(-) Cov"="neg", "(0) Cov"="zero", "(+) Cov"="pos")) %>% unname
factor(sapply(summ$cov, function(c) switch(c, "(-) Cov"="neg", "(0) Cov"="zero", "(+) Cov"="pos")) %>% unname)
factor(sapply(summ$cov, function(c) switch(c, "(-) Cov"="neg", "(0) Cov"="zero", "(+) Cov"="pos")) %>% unname, levels=c("pos","zero","neg"))
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>% group_by(cov, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() -> summ
summ$cov <- factor(sapply(summ$cov, function(c) switch(c, "(-) Cov"="neg", "(0) Cov"="zero", "(+) Cov"="pos")) %>% unname, levels=c("pos","zero","neg"))
with(summ, lm(peak~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
write.csv(contrasts2, file="Cov_effects_on_peak_stats.csv")
contrasts2
covMatrix
covMatrix = "nocorr"
z1 = readRDS(paste0(paste("out",covMatrix,"hivar",var1[j],var2[j],sep="_"),".RDS"))
z2 = readRDS(paste0(paste("out",covMatrix,"medvar",var1[j],var2[j],sep="_"),".RDS"))
z3 = readRDS(paste0(paste("out",covMatrix,"lowvar",var1[j],var2[j],sep="_"),".RDS"))
i = 1
z1[[i]]
str(z[[1]])
str(z1[[1]])
z1[[i]][[2]]
z1[[i]][[2]]$numInf
sort(z1[[i]][[2]]$numInf)
sort(z1[[i]][[2]]$numInf)[1:round(0.8*nrow(z1[[i]][[2]]))]
round(0.8*nrow(z1[[i]][[2]]))
nrow(z1[[i]][[2]])
round(0.2*nrow(z1[[i]][[2]]))
sort(z1[[i]][[2]]$numInf)[1:round(0.2*nrow(z1[[i]][[2]]))]
?sort
sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))]
sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])
sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf)
lapply(1:length(z1), function(i) mutate(top20SS=sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
rep=i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-"))
lapply(1:length(z1), function(i) mutate(top20SS=sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
rep=i))
top20SS=sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf)
top20SS
lapply(1:length(z1), function(i) c(top20SS=sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
rep=i))
lapply(1:length(z1), function(i) c(top20SS=sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
rep=i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-"))
lapply(1:length(z1), function(i) c(sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[1]]
lapply(1:length(z1), function(i) c(sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[1]]
z <- vector(mode='list',length=3)
lapply(1:length(z1), function(i) c(sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[1]]
z[[1]]
colnames(z[[1]])[1:2] <- c("top20SS","rep")
z[[1]]
var1=c('c','c','c','shed','shed','alpha')
var2=c('shed','alpha','gamma','alpha','gamma','gamma')
i <- 1
data <- vector(mode='list', length=18)
for (j in 1:6) { ## loop over the six different covariance combinations
for (covMatrix in c("nocorr", "negcorr", "poscorr")) {
z1 = readRDS(paste0(paste("out",covMatrix,"hivar",var1[j],var2[j],sep="_"),".RDS"))
z2 = readRDS(paste0(paste("out",covMatrix,"medvar",var1[j],var2[j],sep="_"),".RDS"))
z3 = readRDS(paste0(paste("out",covMatrix,"lowvar",var1[j],var2[j],sep="_"),".RDS"))
z <- vector(mode='list',length=3)
lapply(1:length(z1), function(i) c(sum(sort(z1[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z1[[i]][[2]]))])/sum(z1[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="high",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[1]]
colnames(z[[1]])[1:2] <- c("top20SS","rep")
lapply(1:length(z2), function(i) c(sum(sort(z2[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z2[[i]][[2]]))])/sum(z2[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="med",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[2]]
colnames(z[[2]])[1:2] <- c("top20SS","rep")
lapply(1:length(z3), function(i) c(sum(sort(z3[[i]][[2]]$numInf,decreasing=TRUE)[1:round(0.2*nrow(z3[[i]][[2]]))])/sum(z3[[i]][[2]]$numInf),
i)) %>%
do.call("rbind.data.frame",.) %>%
mutate(., Variance="low",cov=covMatrix, traits=paste(var1[j],var2[j],sep="-")) -> z[[3]]
colnames(z[[3]])[1:2] <- c("top20SS","rep")
data[[i]] <- do.call("rbind.data.frame",z)
i <- i+1
}
}
data[[1]]
data %>% do.call("rbind.data.frame",.) -> data
data
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("nocorr", "negcorr", "poscorr")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>% group_by(Variance, rep) %>% summarise(peak=ifelse(max(I)>50,max(I),NA)) %>%
as.data.frame() %>%
with(., lm(top20SS~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix)
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>%
as.data.frame() %>%
with(., lm(top20SS~Variance)) %>% emmeans(pairwise~Variance)-> comparison
comparison
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("nocorr", "negcorr", "poscorr")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>%
as.data.frame() %>%
with(., lm(top20SS~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
contrasts2
write.csv(contrasts2, file="Var_effects_on_SS_stats.csv")
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() %>%
with(., lm(top20SS~covMatrix)) %>% emmeans(pairwise~covMatrix)-> comparison
var = "high"
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() %>%
with(., lm(top20SS~covMatrix)) %>% emmeans(pairwise~covMatrix)-> comparison
covMatrix
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() %>%
with(., lm(top20SS~cov)) %>% emmeans(pairwise~cov)-> comparison
comparison
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() -> summ
summ$cov <- factor(sapply(summ$cov, function(c) switch(c, "negcorr"="neg", "nocorr"="zero", "poscorr"="pos")) %>% unname, levels=c("pos","zero","neg"))
with(., lm(top20SS~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() -> summ
summ
summ$cov <- factor(sapply(summ$cov, function(c) switch(c, "negcorr"="neg", "nocorr"="zero", "poscorr"="pos")) %>% unname, levels=c("pos","zero","neg"))
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() -> summ
summ$cov <- factor(sapply(summ$cov, function(c) switch(c, "negcorr"="neg", "nocorr"="zero", "poscorr"="pos")) %>% unname, levels=c("pos","zero","neg"))
with(summ, lm(top20SS~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
contrasts2
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (covMatrix in c("nocorr", "negcorr", "poscorr")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & cov==covMatrix) %>%
as.data.frame() %>%
with(., lm(top20SS~Variance)) %>% emmeans(pairwise~Variance)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Covariance=covMatrix, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
write.csv(contrasts2, file="Var_effects_on_SS_stats.csv")
contrasts <- vector(mode='list', length=18)
i <- 1
for (j in 1:6) {
for (var in c("high", "med", "low")) {
filter(data, traits==paste(var1[j],var2[j],sep='-') & Variance==var) %>%
as.data.frame() -> summ
summ$cov <- factor(sapply(summ$cov, function(c) switch(c, "negcorr"="neg", "nocorr"="zero", "poscorr"="pos")) %>% unname, levels=c("pos","zero","neg"))
with(summ, lm(top20SS~cov)) %>% emmeans(pairwise~cov)-> comparison ## see https://timmastny.com/blog/tests-pairwise-categorical-mean-emmeans-contrast/
comparison$contrasts %>% as.data.frame %>% mutate(., Variance=var, traits=paste(var1[j],var2[j],sep='-')) -> contrast
contrasts[[i]] <- contrast
i <- i + 1
}
}
contrasts %>% do.call("rbind.data.frame", .) -> contrasts2
write.csv(contrasts2, file="Cov_effects_on_SS_stats.csv")
